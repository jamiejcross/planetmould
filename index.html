<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>News - Planet Mould</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
<div class="banner">
  <a href="https://planetmould.com" class="brand">The Future is Mouldy</a>
  <input type="checkbox" class="nav-toggle" id="navToggle" />
  <label for="navToggle" class="hamburger">â˜°</label>
  <div class="links">
    <a href="https://planetmould.com">Home</a>
    <a href="https://news.planetmould.com/">Mouldwire</a>
    <a href="https://planetmould.com/publications.html">Publications</a>
    <a href="https://planetmould.com/collaborations.html">Collaborations</a>
  </div>
</div>

  
  <div class="page-header">
    <h1>Mouldwire</h1>
    <p>Mouldwire is a bespoke science and media news service designed to pick up the latest mould related research from ~50 peer reviewed scientific journals; mould related press releases from public health agencies, environmental bodies, and standards organisations; mould related stories being reported by news organisations; and mould information circulating via social medoia. The engine uses a unique list of RSS feeds and a set of extensive keywords developed solely for this website. This beta version was launched in Jan 2026 and is currently in development.</p>
  </div>

  <div class="controls">
    <div class="filter-row">
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All News</button>
        <button class="filter-btn" data-filter="science">Scientific Research</button>
        <button class="filter-btn" data-filter="media">Popular Media</button>
        <button class="filter-btn" data-filter="health">Health & Environment</button>
        <button class="filter-btn" data-filter="indoor">Housing & Indoor Air</button>
        <button class="filter-btn" data-filter="clinical">Clinical</button>
      </div>
      <button id="refreshBtn" class="refresh-btn">Refresh Feed</button>
    </div>
    
    <div class="search-container">
      <input type="text" id="newsSearch" placeholder="Search filtered news (e.g. 'Glasgow', 'Resistance', 'Ventilation')..." />
    </div>
  </div>

  <div id="newsContainer">
    <div class="loading">
      <div class="spinner"></div>
      <p>Scanning the biosphere...</p>
    </div>
  </div>

  <div id="loadMoreContainer" style="text-align: center; margin: 40px 0; display: none;">
      <button id="loadMoreBtn" class="refresh-btn">Load More Results</button>
  </div>

  <div class="footer-banner">
    <div class="footer-left">
      <div class="footer-credit">
        <p>Planet Mould is supported by the University of Glasgow.</p>
        <p>Website, Photographs + Design: delacroix@edinburghpress.com</p>
      </div>
      <a href="mailto:jamie.cross@glasgow.ac.uk" class="email">jamie.cross@glasgow.ac.uk</a>
    </div>
    <img src="glasgow logo.png" alt="University of Glasgow" class="uni-logo" />
  </div>

<script>
  // 1. GLOBAL STATE
  let allNews = { science: [], media: [], health: [], indoor: [], clinical: [] };
  let currentFilter = "all";
  let visibleCount = 20;

  // 2. CATEGORY MAPPING (maps AI categories to your filter categories)
  const categoryMap = {
    'Scientific Research': 'science',
    'Popular Media': 'media',
    'Health & Environment': 'health',
    'Housing & Indoor Air': 'indoor',
    'Clinical': 'clinical'
  };

  // 3. FETCH ENGINE (Now supports BOTH mould_news.json AND articles_enhanced.json)
  async function fetchNews() {
    const container = document.getElementById("newsContainer");
    try {
      // Try loading AI-enhanced articles first
      let response = await fetch('articles_enhanced.json?v=' + new Date().getTime());
      let data;
      let isEnhanced = false;
      
      if (response.ok) {
        // We have enhanced articles!
        data = await response.json();
        isEnhanced = true;
        console.log('âœ¨ Loaded AI-enhanced articles');
      } else {
        // Fall back to original mould_news.json
        response = await fetch('mould_news.json?v=' + new Date().getTime());
        data = await response.json();
        console.log('Loaded regular articles');
      }
      
      // Clear previous data
      allNews = { science: [], media: [], health: [], indoor: [], clinical: [] };
      
      // Process articles
      data.forEach(item => {
        // Handle date
        item.pubDate = new Date(item.published || item.pubDate || item.published_date);
        
        // Determine category
        let category;
        if (isEnhanced) {
          // Map AI category to your filter category
          const aiCategory = item.primary_category || item.category;
          category = categoryMap[aiCategory] || 'science'; // default to science if unknown
        } else {
          // Use existing category
          category = item.category;
        }
        
        // Add to appropriate category
        if (allNews[category]) {
          allNews[category].push(item);
        }
      });
      
      displayNews();
    } catch (e) {
      console.error("Fetch error:", e);
      container.innerHTML = `<p class="empty-state" style="padding:40px; text-align:center;">The biosphere archive is currently updating. Please refresh in a moment.</p>`;
    }
  }

  // 4. UI ENGINE (Updated to show AI summaries and keywords)
  function displayNews() {
    const container = document.getElementById("newsContainer");
    const searchInput = document.getElementById("newsSearch");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    const query = searchInput ? searchInput.value.toLowerCase() : "";
    
    let combinedNews = [];
    const activeCats = currentFilter === "all" ? Object.keys(allNews) : [currentFilter];
    activeCats.forEach(cat => combinedNews.push(...allNews[cat]));

    // Filter by search query (now includes AI summary and keywords!)
    const filtered = combinedNews
      .filter(item => {
        const searchText = [
          item.title,
          item.source,
          item.excerpt,
          item.summary,
          item.ai_summary,
          (item.keywords || []).join(' ')
        ].join(' ').toLowerCase();
        return searchText.includes(query);
      })
      .sort((a, b) => b.pubDate - a.pubDate);

    const resultsToShow = filtered.slice(0, visibleCount);

    if (resultsToShow.length > 0) {
      let html = `<div class="news-list">`;
      
      // BUILD EACH ARTICLE CARD
      resultsToShow.forEach(item => {
        // Get summary (AI-generated if available, otherwise excerpt)
        const summary = item.summary || item.ai_summary || item.excerpt || '';
        
        // Get keywords
        const keywords = item.keywords || [];
        
        // Check if AI-enhanced
        const isEnhanced = !!(item.summary || item.keywords);
        
        html += `
          <div class="news-item">
            <div class="news-meta">
              <span><strong>Published:</strong> ${item.pubDate.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}</span>
              <span><strong>Source:</strong> ${item.source}</span>
              ${isEnhanced ? '<span class="ai-badge">ð–¡Ž Prompt Engineered AI Summary</span>' : ''}
            </div>
            <h3 class="news-title"><a href="${item.url || item.link}" target="_blank">${item.title}</a></h3>
            ${summary ? `<p class="news-excerpt">${summary}</p>` : ''}
            ${keywords.length > 0 ? `
              <div class="news-keywords">
                ${keywords.slice(0, 5).map(k => `<span class="keyword-tag">${k}</span>`).join('')}
              </div>
            ` : ''}
            <a href="${item.url || item.link}" target="_blank" class="read-more">View original source online â†’</a>
          </div>`;
      });
      
      html += `</div>`;
      container.innerHTML = html;

      if (loadMoreContainer) {
        loadMoreContainer.style.display = (filtered.length > visibleCount) ? "block" : "none";
      }
    } else {
      container.innerHTML = `<p class="empty-state" style="padding:40px; text-align:center;">No matching mould wires found in the archive.</p>`;
      if (loadMoreContainer) loadMoreContainer.style.display = "none";
    }
  }

  // 5. INITIALIZE
  window.onload = () => {
    fetchNews();

    document.getElementById("newsSearch")?.addEventListener("input", () => {
      visibleCount = 20; 
      displayNews();
    });

    document.getElementById("refreshBtn")?.addEventListener("click", () => {
      visibleCount = 20;
      fetchNews();
    });

    document.getElementById("loadMoreBtn")?.addEventListener("click", () => {
      visibleCount += 20;
      displayNews();
    });

    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        e.target.classList.add("active");
        currentFilter = e.target.dataset.filter;
        visibleCount = 20; 
        displayNews();
      });
    });
  };
</script>
</body>
</html>
