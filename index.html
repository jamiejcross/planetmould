<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>News - Planet Mould</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
<div class="banner">
  <a href="https://planetmould.com" class="brand">The Future is Mouldy</a>
  <input type="checkbox" class="nav-toggle" id="navToggle" />
  <label for="navToggle" class="hamburger">☰</label>
  <div class="links">
    <a href="https://planetmould.com">Home</a>
    <a href="https://news.planetmould.com/">Mouldwire</a>
    <a href="https://planetmould.com/publications.html">Publications</a>
    <a href="https://planetmould.com/collaborations.html">Collaborations</a>
  </div>
</div>

  
  <div class="page-header">
    <h1>Mouldwire</h1>
    <p>Mouldwire is a bespoke science and media news service designed to pick up the latest mould related research from ~50 peer reviewed scientific journals; mould related press releases from public health agencies, environmental bodies, and standards organisations; mould related stories being reported by news organisations; and mould information circulating via social medoia. The engine uses a unique list of RSS feeds and a set of extensive keywords developed solely for this website. This beta version was launched in Jan 2026 and is currently in development.</p>
  </div>

  <div class="controls">
    <div class="filter-row">
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All News</button>
        <button class="filter-btn" data-filter="science">Scientific Research</button>
        <button class="filter-btn" data-filter="media">Popular Media</button>
        <button class="filter-btn" data-filter="health">Health & Environment</button>
        <button class="filter-btn" data-filter="indoor">Housing & Indoor Air</button>
        <button class="filter-btn" data-filter="clinical">Clinical</button>
      </div>
      <button id="refreshBtn" class="refresh-btn">Refresh Feed</button>
    </div>
    
    <div class="search-container">
      <input type="text" id="newsSearch" placeholder="Search filtered news (e.g. 'Glasgow', 'Resistance', 'Ventilation')..." />
    </div>
  </div>

  <div id="newsContainer">
    <div class="loading">
      <div class="spinner"></div>
      <p>Scanning the biosphere...</p>
    </div>
  </div>

  <div id="loadMoreContainer" style="text-align: center; margin: 40px 0; display: none;">
      <button id="loadMoreBtn" class="refresh-btn">Load More Results</button>
  </div>

  <div class="footer-banner">
    <div class="footer-left">
      <div class="footer-credit">
        <p>Planet Mould is supported by the University of Glasgow.</p>
        <p>Website, Photographs + Design: delacroix@edinburghpress.com</p>
      </div>
      <a href="mailto:jamie.cross@glasgow.ac.uk" class="email">jamie.cross@glasgow.ac.uk</a>
    </div>
    <img src="glasgow logo.png" alt="University of Glasgow" class="uni-logo" />
  </div>

<script>
 // 1. GLOBAL STATE
  let allNews = []; // Changed to Array to support .filter()
  let currentFilter = "all";
  let visibleCount = 20;

  // 2. CATEGORY MAPPING
  const categoryMap = {
    'Scientific Research': 'science',
    'Popular Media': 'media',
    'Health & Environment': 'health',
    'Housing & Indoor Air': 'indoor',
    'Clinical': 'clinical'
  };

  // 3. FETCH ENGINE
  async function fetchNews() {
    const container = document.getElementById("newsContainer");
    try {
      let response = await fetch('articles_enhanced.json?v=' + new Date().getTime());
      let data;
      
      if (response.ok) {
          data = await response.json();
          console.log('✓ Loaded enhanced articles');
      } else {
          response = await fetch('mould_news.json?v=' + new Date().getTime());
          if (!response.ok) throw new Error("Could not load any news files.");
          data = await response.json();
          console.log('⚠ Loaded regular articles');
      }

      // Assign to global state
      allNews = data; 
      displayNews();

    } catch (error) {
      console.error("Error loading news:", error);
      if (container) {
        container.innerHTML = `<p class="error-state" style="padding:40px; text-align:center;">The biosphere archive is currently updating. Please refresh in a moment.</p>`;
      }
    }
  }

  // 4. UI ENGINE
  function displayNews() {
    const container = document.getElementById("newsContainer");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    if (!container) return;

    // Filter logic
    let filtered = allNews;
    if (currentFilter !== 'all') {
      filtered = allNews.filter(item => {
        // Check both the raw category and the AI primary_category
        const aiMappedCat = categoryMap[item.primary_category];
        return item.category === currentFilter || aiMappedCat === currentFilter;
      });
    }

    // Search logic
    const searchTerm = document.getElementById("newsSearch")?.value.toLowerCase();
    if (searchTerm) {
      filtered = filtered.filter(item => 
        item.title.toLowerCase().includes(searchTerm) || 
        (item.summary && item.summary.toLowerCase().includes(searchTerm)) ||
        (item.excerpt && item.excerpt.toLowerCase().includes(searchTerm))
      );
    }

    if (filtered.length > 0) {
      let html = `<div class="news-list">`;
      
      filtered.slice(0, visibleCount).forEach(item => {
          const isEnhanced = item.enhanced === true;
          
          // Sentence Case formatting
          let rawSummary = item.summary || item.excerpt || "";
          const summary = rawSummary
            .toLowerCase()
            .replace(/(^\s*\w|[\.\!\?]\s*\w)/g, c => c.toUpperCase());

          const keywords = item.keywords || [];
          const displayDate = item.pubDate ? new Date(item.pubDate).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) : 'Recent';

          html += `
            <div class="news-item">
              <div class="news-meta">
                <span><strong>Published:</strong> ${displayDate}</span>
                <span><strong>Source:</strong> ${item.source}</span>
              </div>
              
              <h3 class="news-title"><a href="${item.url}" target="_blank">${item.title}</a></h3>
              
              ${isEnhanced ? '<span class="ai-badge" style="background:#eee; padding:2px 8px; font-size:10px; border-radius:4px; border:1px solid #ddd;">⚛ 3 Sentence AI Summary</span>' : ''}
              
              ${summary ? `<p class="news-excerpt" style="font-size: 0.95rem; line-height: 1.6; margin: 12px 0;">${summary}</p>` : ''}
              
              ${keywords.length > 0 ? `
                <div class="news-keywords" style="margin-top:10px;">
                  ${keywords.slice(0, 3).map(k => `<span class="keyword-tag" style="background:#f0f0f0; padding:2px 8px; margin-right:5px; font-size:11px; border-radius:12px;">${k}</span>`).join('')}
                </div>
              ` : ''}
              
              <div class="source-link-container" style="margin-top: 15px;">
                <a href="${item.url}" target="_blank" class="read-more" style="text-decoration:none; font-weight:bold; color:#000; font-size:13px;">View original source online →</a>
              </div>
              
              <hr class="news-divider" style="border: 0; border-top: 1px solid #000; margin: 30px 0; opacity: 0.1;">
            </div>`;
      });
      
      html += `</div>`;
      container.innerHTML = html;
      if (loadMoreContainer) loadMoreContainer.style.display = (filtered.length > visibleCount) ? "block" : "none";
    } else {
      container.innerHTML = `<p class="empty-state" style="padding:40px; text-align:center;">No matching mould wires found.</p>`;
      if (loadMoreContainer) loadMoreContainer.style.display = "none";
    }
  }

  // 5. INITIALIZE
  window.onload = () => {
    fetchNews();

    document.getElementById("newsSearch")?.addEventListener("input", () => {
      visibleCount = 20; 
      displayNews();
    });

    document.getElementById("refreshBtn")?.addEventListener("click", () => {
      visibleCount = 20;
      fetchNews();
    });

    document.getElementById("loadMoreBtn")?.addEventListener("click", () => {
      visibleCount += 20;
      displayNews();
    });

    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        e.target.classList.add("active");
        currentFilter = e.target.dataset.filter;
        visibleCount = 20; 
        displayNews();
      });
    });
  };
</script>
</body>
</html>
