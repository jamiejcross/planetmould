<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>News - Planet Mould</title>
  <link rel="stylesheet" href="css/styles.css" />

  <style>
  /* GLOBAL AESTHETIC FIXES */
  :root {
    --black: #000;
    --grey: #666;
    --border: #000;
  }

  /* Reset all links to black */
  a {
    color: var(--black) !important;
    text-decoration: none;
  }
  
  a:hover {
    text-decoration: underline;
  }

  /* NEWS ITEM STYLING (The Field Guide Look) */
  .news-item {
    padding-top: 40px;
    padding-bottom: 60px;
    border-bottom: 1px solid var(--black) !important;
    background: transparent;
  }

  .read-more {
    font-weight: 800;
    font-size: 16px;
    color: #3a3a3a;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    margin-top: 10px;
    padding-bottom: 2px;
    border-bottom: none;
    text-decoration: none;
    margin-bottom: 0px;
  }

  /* AI BADGE - plain text label */
  .ai-badge {
    display: inline-block;
    background: none;
    color: #3a3a3a;
    font-size: 16px;
    font-weight: 800;
    text-transform: uppercase;
    margin-top: 2px;
    letter-spacing: 0.5px;
  }

  .keyword-tag {
    background: #eee;
    padding: 3px 10px;
    margin-right: 8px;
    font-size: 11px;
    border-radius: 4px;
    color: #444;
    text-transform: uppercase;
  }


    
    /* --- MOBILE NAVIGATION LOGIC --- */

/* 1. Hide the checkbox and the links by default on mobile */
#navToggle, .links {
    display: none;
}

/* 2. Show the hamburger icon only on mobile */
.hamburger {
    display: block;
    font-size: 16px;
    cursor: pointer;
    color: #000;
}

/* 3. THE MAGIC: When checkbox is checked, show the links */
#navToggle:checked ~ .links {
    display: flex;
    flex-direction: column;
    width: 100%;
    background: #fff;
    position: absolute;
    top: 60px; /* Adjust based on your banner height */
    left: 0;
    z-index: 1000;
    border-bottom: 2px solid #000;
    padding: 20px;
}

/* 4. Desktop View: Hide hamburger and show links horizontally */
@media (min-width: 768px) {
    .hamburger {
        display: none;
    }
    .links {
        display: flex !important;
        flex-direction: row;
        position: static;
        padding: 0;
        border: none;
    }
}
</style>
  
</head>
<body>
<div class="banner">
  <a href="https://planetmould.com" class="brand">The Future is Mouldy</a>

  <input type="checkbox" id="navToggle" class="nav-toggle">
  <label for="navToggle" class="hamburger">☰</label>

  <div class="links">
    <a href="https://planetmould.com/breakitdown.html">Break it Down</a>
    <a href="https://news.planetmould.com/">Mouldwire</a>
    <a href="https://planetmould.com/texts.html">Texts</a>
    <a href="https://planetmould.com/collaborations.html">Collaborations</a>
  </div>
</div>

<div class="page-header">
    <h1>Mouldwire</h1>
    <p>Mouldwire is a bespoke science/media news service designed to collect and summarise the latest mould related research stories from around the world using a prompt engineered inference engine. This version uses a "Patchy Anthropocene" lens that is specially calibrated for social science, arts and humanities researchers interested in human/non-human interactions in materially and chemically changed environments.</p>
   <p class="repo-callout">
    Mouldwire is an open source project. You can follow the development, 
    view the summaries in raw format, or contribute to the 
    code on Github. 
    <p><a href="https://github.com/jamiejcross/planetmould" target="_blank" class="github-link-inline"></p>
        <svg height="30" width="30" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: middle; margin-bottom: 2px;">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        <strong>GitHub Repository</strong>
        </a>
  </p>
  <p>
    <a href="https://www.theaimeters.com/" target="_blank" class="aimeters-link-inline"></p>
    <img src="AI-HL-PRweb.png" alt="AI-HL-PR" class="AI-HL-PR-logo">
  </a>
</p>

  </div>

<div class="controls">
    <div class="filter-row">
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">Show All</button>
            <button class="filter-btn" data-filter="science">Microbiology</button>
            <button class="filter-btn" data-filter="health">Health & Environment</button>
            <button class="filter-btn" data-filter="indoor">Housing & Indoor Air</button>
            <button class="filter-btn" data-filter="media">Media Feeds * Coming Soon</button>
        </div>
        <div class="log-stats" id="logStats"></div>
        <input type="text" id="newsSearch" class="search-input" placeholder="Use keywords to search for reports since Feb 10th 2026" />
    </div>
</div>

<div id="newsContainer">
    <div class="loading">
        <div class="spinner"></div>
        <p>Scanning the biosphere...</p>
    </div>
</div>

<div id="loadMoreContainer" style="text-align: center; margin: 40px 0; display: none;">
    <button id="loadMoreBtn" class="refresh-btn">Load More Results</button>
</div>
    
<div class="system-logs">
    <h4>Mouldwire System Log</h4>
    <ul class="log-list" id="logList">
        <li>
            <span class="log-date">...</span>
            <span class="log-event">Loading system log...</span>
        </li>
    </ul>
</div>

<footer class="footer-banner">
  <div class="footer-left">
    <div class="footer-credit">
      <p>Planet Mould is supported by the University of Glasgow.</p>
      <div class="contact-info">
        <p>For further information, contact:</p>
        <a class="email" href="mailto:jamie.cross@glasgow.ac.uk">jamie.cross@glasgow.ac.uk</a>
      </div>
    </div>

    <div class="footer-attribution">
      <p>Text, Website, Photographs, and Design: Jamie Cross</p>
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">
        <img class="cc-icon" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0" />
      </a>
    </div>
  </div>
  <img class="uni-logo" src="glasgow logo.png" alt="University logo" />
</footer>

    
    
<script>
  let allNews = []; 
  let currentFilter = "all";
  let visibleCount = 5;

  const categoryMap = {
    'Microbiology': 'science',
    'Social Media': 'media',
    'Health & Environment': 'health',
    'Housing & Indoor Air': 'indoor',
    'Clinical': 'science'
  };

  const theoryKeywords = ['anthropology', 'sociology', 'ethnography', 'material culture', 'political economy', 'infrastructure', 'sociality', 'biopolitics'];

  async function fetchNews() {
    const container = document.getElementById("newsContainer");
    try {
      let response = await fetch('articles_enhanced.json?v=' + new Date().getTime());
      if (!response.ok) response = await fetch('mould_news.json?v=' + new Date().getTime());
      allNews = await response.json(); 
      displayNews();
    } catch (error) {
      container.innerHTML = `<p class="error-state" style="padding:40px; text-align:center;">The biosphere is currently updating.</p>`;
    }
  }

  function displayNews() {
    const container = document.getElementById("newsContainer");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    if (!container) return;

    let filtered = allNews;

    // Filter logic
    if (currentFilter !== 'all') {
      filtered = allNews.filter(item => {
        const text = (item.title + " " + (item.summary || "")).toLowerCase();
        const isTheory = theoryKeywords.some(k => text.includes(k));
        if (currentFilter === 'theory') return isTheory;
        const aiMappedCat = categoryMap[item.primary_category];
        return item.category === currentFilter || aiMappedCat === currentFilter;
      });
    }

    // Search logic
    const searchTerm = document.getElementById("newsSearch")?.value.toLowerCase();
    if (searchTerm) {
      filtered = filtered.filter(item => 
        item.title.toLowerCase().includes(searchTerm) || 
        (item.summary && item.summary.toLowerCase().includes(searchTerm))
      );
    }

    // Non-journal news outlets (everything else is treated as a journal)
    const newsOutlets = ['sciencedaily', 'phys.org', 'bbc', 'guardian', 'reuters', 'associated press'];

    function isJournalSource(source) {
      if (!source) return false;
      const s = source.toLowerCase();
      return !newsOutlets.some(outlet => s.includes(outlet));
    }

    if (filtered.length > 0) {
      const visible = filtered.slice(0, visibleCount);
      let html = `<div class="news-list">`;
      visible.forEach((item, index) => {
        const isEnhanced = item.enhanced === true;
        const isLast = index === visible.length - 1;
        const displayDate = item.pubDate ? new Date(item.pubDate).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) : 'Recent';
        let rawSummary = item.summary || item.excerpt || "";
        let formattedSummary = rawSummary.length > 0 ? rawSummary : "No summary available for this wire.";
        const titlePrefix = isJournalSource(item.source) ? '<strong>New Research:</strong> ' : '';
                const excerptBlock = isEnhanced
          ? `
            <details class="ai-dropdown">
              <summary class="ai-badge">Mouldwire Patchy Anthropocene Summary →</summary>
              <div class="ai-dropdown-panel">
                <p class="news-excerpt">${formattedSummary}</p>
              </div>
            </details>
          `
          : `<p class="news-excerpt">${formattedSummary}</p>`;


        html += `
          <div class="news-item">
            <div class="news-meta">
              <span><strong>Published:</strong> ${displayDate}</span>
              <span><strong>Source:</strong> ${item.source}</span>
              </div>
            <h2 class="news-title">${item.title}</h2>
            <div class="news-keywords">
              ${(item.keywords || []).slice(0, 3).map(k => `<span class="keyword-tag">${k}</span>`).join('')}
            </div>
            ${excerptBlock}
            <div class="source-link-container">
              <a href="${item.url}" target="_blank" class="read-more">View source online →</a>
            </div>
          </div>`;
      });
      html += `</div>`;
      container.innerHTML = html;

      // LOAD MORE LOGIC
      if (loadMoreContainer) {
          loadMoreContainer.style.display = (filtered.length > visibleCount) ? "block" : "none";
      }

    } else {
      container.innerHTML = `<p style="padding:40px; text-align:center;">No matching mould wires found.</p>`;
      if (loadMoreContainer) loadMoreContainer.style.display = "none";
    }
  }

  // --- SYSTEM LOG ---
  async function fetchSystemLog() {
    const logList = document.getElementById("logList");
    const logStats = document.getElementById("logStats");
    if (!logList) return;

    try {
      const response = await fetch('system_log.json?v=' + new Date().getTime());
      if (!response.ok) throw new Error('Log not available');
      const log = await response.json();

      // Render summary stats bar
      if (log.summary && logStats) {
        const s = log.summary;
        const updated = s.last_updated ? new Date(s.last_updated).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : '';

        // Find today's new articles from entries
        const today = new Date().toISOString().slice(0, 10);
        const dailyEntry = (log.entries || []).find(e => e.type === 'daily' && e.date === today);
        const newToday = dailyEntry ? dailyEntry.event : 'No new articles today.';

        logStats.innerHTML = `
          <div class="log-stat-row">
            <span class="log-stat"><strong>${s.total_articles || 0}</strong> articles in archive</span>
            <span class="log-stat"><strong>${s.total_enhanced || 0}</strong> enhanced</span>
            <span class="log-stat log-stat-new">${newToday}</span>
          </div>
          <div class="log-stat-updated">Last pipeline run: ${updated}</div>
        `;
      }

      // Render log entries (show last 10)
      const entries = (log.entries || []).slice(0, 10);
      if (entries.length === 0) {
        logList.innerHTML = '<li><span class="log-event">No log entries yet.</span></li>';
        return;
      }

      logList.innerHTML = entries.map(entry => {
        const typeIcon = {
          'engine': '\u2699\uFE0F',
          'calibration': '\uD83D\uDD2C',
          'milestone': '\uD83D\uDCCC',
          'daily': '\uD83D\uDCE1',
          'error': '\u26A0\uFE0F'
        }[entry.type] || '\u25CF';

        return `<li>
          <span class="log-date">${entry.date || ''}</span>
          <span class="log-type-icon">${typeIcon}</span>
          <span class="log-event">${entry.event || ''}</span>
        </li>`;
      }).join('');

    } catch (err) {
      // Fallback: keep whatever's in the HTML
      console.log('System log not available, using static fallback.');
    }
  }

  window.onload = () => {
    fetchNews();
    fetchSystemLog();
    document.getElementById("newsSearch")?.addEventListener("input", () => { visibleCount = 5; displayNews(); });
    document.getElementById("refreshBtn")?.addEventListener("click", () => { visibleCount = 5; fetchNews(); });
    document.getElementById("loadMoreBtn")?.addEventListener("click", () => { visibleCount += 5; displayNews(); });
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        e.target.classList.add("active");
        currentFilter = e.target.dataset.filter;
        visibleCount = 5;
        displayNews();
      });
    });
  };
</script>
</body>
</html>
