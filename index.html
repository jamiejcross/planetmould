<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>News - Planet Mould</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    /* Responsive Metadata Styling */
    .news-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 12px;
      font-size: 0.85rem;
      line-height: 1.4;
      color: #666;
    }
    .news-meta strong {
      font-weight: 700;
      color: #333;
    }
    /* Simple AI Badge Styling */
    .ai-badge {
      display: inline-block;
      background: #fff;
      border: 1px solid #000;
      color: #000;
      padding: 2px 10px;
      font-size: 10px;
      font-weight: 800;
      border-radius: 0px;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin: 10px 0;
    }
  </style>
</head>
<body>
<div class="banner">
  <a href="https://planetmould.com" class="brand">The Future is Mouldy</a>
  <input type="checkbox" class="nav-toggle" id="navToggle" />
  <label for="navToggle" class="hamburger">☰</label>
  <div class="links">
    <a href="https://planetmould.com">Home</a>
    <a href="https://news.planetmould.com/">Mouldwire</a>
    <a href="https://planetmould.com/publications.html">Publications</a>
    <a href="https://planetmould.com/collaborations.html">Collaborations</a>
  </div>
</div>

  <div class="page-header">
    <h1>Mouldwire</h1>
    <p>Mouldwire is a bespoke science and media news service designed to collect and distribute the latest mould related research, news and stories. This version is optimised for social scientists interested in planetary health, infrastructure, and human/non-human sociality. Mouldwire scans ~50 international peer reviewed scientific journals; public health agencies, environmental bodies, and standards organisations, news organisations; and social media platforms.</p>
    <p>Mouldwire is an open source project and is in active development. Further details and all code are available on <a href="https://github.com/jamiejcross/planetmould">Github</a></p>
  </div>

  <div class="controls">
    <div class="filter-row">
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All News</button>
        <button class="filter-btn" data-filter="theory">Theory & Ethnography</button>
        <button class="filter-btn" data-filter="science">Scientific Research</button>
        <button class="filter-btn" data-filter="health">Health & Environment</button>
        <button class="filter-btn" data-filter="indoor">Housing & Indoor Air</button>
        <button class="filter-btn" data-filter="media">Media</button>
      </div>
      <button id="refreshBtn" class="refresh-btn">Refresh Feed</button>
    </div>
    
    <div class="search-container">
      <input type="text" id="newsSearch" placeholder="Search (e.g. 'Infrastructure', 'Materiality', 'Tsing')..." />
    </div>
  </div>

  <div id="newsContainer">
    <div class="loading">
      <div class="spinner"></div>
      <p>Scanning the biosphere...</p>
    </div>
  </div>

  <div id="loadMoreContainer" style="text-align: center; margin: 40px 0; display: none;">
      <button id="loadMoreBtn" class="refresh-btn">Load More Results</button>
  </div>

  <div class="footer-banner">
    <div class="footer-left">
      <div class="footer-credit">
        <p>Planet Mould is supported by the University of Glasgow.</p>
        <p>Website, Photographs + Design: delacroix@edinburghpress.com</p>
      </div>
      <a href="mailto:jamie.cross@glasgow.ac.uk" class="email">jamie.cross@glasgow.ac.uk</a>
    </div>
    <img src="glasgow logo.png" alt="University of Glasgow" class="uni-logo" />
  </div>

<script>
  let allNews = []; 
  let currentFilter = "all";
  let visibleCount = 20;

  const categoryMap = {
    'Scientific Research': 'science',
    'Popular Media': 'media',
    'Health & Environment': 'health',
    'Housing & Indoor Air': 'indoor',
    'Clinical': 'science' // Merged for simplicity
  };

  const theoryKeywords = ['anthropology', 'sociology', 'ethnography', 'material culture', 'political economy', 'infrastructure', 'sociality', 'biopolitics'];

  async function fetchNews() {
    const container = document.getElementById("newsContainer");
    try {
      let response = await fetch('articles_enhanced.json?v=' + new Date().getTime());
      if (!response.ok) response = await fetch('mould_news.json?v=' + new Date().getTime());
      
      allNews = await response.json(); 
      displayNews();
    } catch (error) {
      container.innerHTML = `<p class="error-state" style="padding:40px; text-align:center;">The biosphere archive is currently updating.</p>`;
    }
  }

  function displayNews() {
    const container = document.getElementById("newsContainer");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    if (!container) return;

    let filtered = allNews;

    // Filter logic
    if (currentFilter !== 'all') {
      filtered = allNews.filter(item => {
        const text = (item.title + " " + (item.summary || "")).toLowerCase();
        const isTheory = theoryKeywords.some(k => text.includes(k));
        
        if (currentFilter === 'theory') return isTheory;
        
        const aiMappedCat = categoryMap[item.primary_category];
        return item.category === currentFilter || aiMappedCat === currentFilter;
      });
    }

    // Search logic
    const searchTerm = document.getElementById("newsSearch")?.value.toLowerCase();
    if (searchTerm) {
      filtered = filtered.filter(item => 
        item.title.toLowerCase().includes(searchTerm) || 
        (item.summary && item.summary.toLowerCase().includes(searchTerm))
      );
    }

    if (filtered.length > 0) {
      let html = `<div class="news-list">`;
      filtered.slice(0, visibleCount).forEach((item) => {
          const isEnhanced = item.enhanced === true;
          const displayDate = item.pubDate ? new Date(item.pubDate).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) : 'Recent';
          // 1. Grab text from any available field (summary is AI-generated, excerpt is from RSS)
let rawSummary = item.summary || item.excerpt || "";

// 2. Safety Fallback: If AI hasn't processed it yet, ensure we show SOMETHING
let formattedSummary = rawSummary.length > 0 ? rawSummary : "No summary available for this wire.";

html += `
  <div class="news-item" style="padding-bottom: 40px; margin-bottom: 40px; border-bottom: 1px solid rgba(0,0,0,0.1);">
    <div class="news-meta">
      <span><strong>Published:</strong> ${displayDate}</span>
      <span><strong>Source:</strong> ${item.source}</span>
    </div>
    <h3 class="news-title"><a href="${item.url}" target="_blank">${item.title}</a></h3>
    
    ${isEnhanced ? '<span class="ai-badge">✨ What does this mean for Planet Mould?</span>' : ''}
    
    <p class="news-excerpt" style="font-size: 0.95rem; line-height: 1.7; margin: 15px 0; color: #333; max-width: 75ch;">${formattedSummary}</p>
              
              <div class="news-keywords">
                ${(item.keywords || []).slice(0, 3).map(k => `<span class="keyword-tag" style="background:#eee; padding:3px 10px; margin-right:8px; font-size:11px; border-radius:4px; color: #444; text-transform: uppercase;">${k}</span>`).join('')}
              </div>
              
              <div style="margin-top: 25px;">
                <a href="${item.url}" target="_blank" style="text-decoration:none; font-weight:bold; color:#000; font-size:13px; text-transform: uppercase; letter-spacing: 1px;">View source online →</a>
              </div>
            </div>`;
      });
      html += `</div>`;
      container.innerHTML = html;
      if (loadMoreContainer) loadMoreContainer.style.display = (filtered.length > visibleCount) ? "block" : "none";
    } else {
      container.innerHTML = `<p style="padding:40px; text-align:center;">No matching mould wires found.</p>`;
    }
  }

  window.onload = () => {
    fetchNews();
    document.getElementById("newsSearch")?.addEventListener("input", () => { visibleCount = 20; displayNews(); });
    document.getElementById("refreshBtn")?.addEventListener("click", () => { visibleCount = 20; fetchNews(); });
    document.getElementById("loadMoreBtn")?.addEventListener("click", () => { visibleCount += 20; displayNews(); });
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        e.target.classList.add("active");
        currentFilter = e.target.dataset.filter;
        visibleCount = 20; 
        displayNews();
      });
    });
  };
</script>
</body>
</html>
